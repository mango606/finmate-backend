<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinMate - íˆ¬ìë¶„ì„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', Arial, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
        }

        .nav-item {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 10px 15px;
            border-radius: 8px;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .user-menu {
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .user-info:hover {
            background: rgba(255,255,255,0.2);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #333;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .risk-analysis {
            margin-bottom: 30px;
        }

        .risk-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .risk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .risk-type {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .risk-level {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-low {
            background: #d4edda;
            color: #155724;
        }

        .risk-medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-high {
            background: #f8d7da;
            color: #721c24;
        }

        .risk-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-list li:last-child {
            border-bottom: none;
        }

        .recommendation-list li::before {
            content: 'ğŸ’';
            font-size: 1rem;
        }

        .portfolio-section {
            margin-bottom: 30px;
        }

        .allocation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .allocation-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #28a745;
        }

        .allocation-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .allocation-percentage {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .allocation-amount {
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
        }

        .quick-actions {
            display: grid;
            gap: 15px;
        }

        .action-btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .action-btn.secondary {
            background: #6c757d;
        }

        .action-btn.secondary:hover {
            background: #5a6268;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .market-trends {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .trend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .trend-item:last-child {
            border-bottom: none;
        }

        .trend-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .trend-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .trend-details h4 {
            margin-bottom: 5px;
            color: #333;
        }

        .trend-details p {
            color: #666;
            font-size: 0.9rem;
        }

        .trend-change {
            text-align: right;
        }

        .change-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .change-positive {
            color: #28a745;
        }

        .change-negative {
            color: #dc3545;
        }

        .change-period {
            font-size: 0.8rem;
            color: #666;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .tips-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .tip-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #17a2b8;
        }

        .tip-item:last-child {
            margin-bottom: 0;
        }

        .tip-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-content {
            color: #666;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .allocation-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
<div id="app">
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <div class="logo">ğŸ¦ FinMate</div>
            <nav class="nav-menu">
                <a href="/" class="nav-item">í™ˆ</a>
                <a href="/dashboard.html" class="nav-item">ëŒ€ì‹œë³´ë“œ</a>
                <a href="/financial.html" class="nav-item">ê¸ˆìœµê´€ë¦¬</a>
                <a href="/investment.html" class="nav-item active">íˆ¬ìë¶„ì„</a>
                <a href="/mypage.html" class="nav-item">ë§ˆì´í˜ì´ì§€</a>
            </nav>
            <div class="user-menu" v-if="user">
                <div class="user-info" @click="goToPage('/mypage.html')">
                    <div class="avatar">{{ user.userName ? user.userName.charAt(0) : 'U' }}</div>
                    <span>{{ user.userName }}ë‹˜</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="page-header">
            <h1 class="page-title">íˆ¬ìë¶„ì„</h1>
            <p class="page-subtitle">ê°œì¸ ë§ì¶¤í˜• íˆ¬ì ì „ëµê³¼ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¶„ì„í•˜ì„¸ìš”</p>
        </div>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div v-if="isLoading" class="loading">
            <div class="spinner"></div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div v-else>
            <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div v-if="alertMessage" :class="['alert', 'alert-' + alertType]">
                <span>{{ alertMessage }}</span>
            </div>

            <!-- ê¸ˆìœµ í”„ë¡œí•„ í•„ìš” ì•Œë¦¼ -->
            <div v-if="!hasProfile" class="alert alert-warning">
                <span>âš ï¸</span>
                <span>íˆ¬ì ë¶„ì„ì„ ìœ„í•´ ë¨¼ì € ê¸ˆìœµ í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</span>
                <a href="/financial.html" style="margin-left: 15px;" class="btn btn-primary">í”„ë¡œí•„ ì„¤ì •í•˜ê¸°</a>
            </div>

            <!-- ì»¨í…ì¸  ê·¸ë¦¬ë“œ -->
            <div v-else class="content-grid">
                <!-- ë©”ì¸ ë¶„ì„ ì˜ì—­ -->
                <div>
                    <!-- íˆ¬ì ì„±í–¥ ë¶„ì„ -->
                    <div class="section risk-analysis">
                        <h2 class="section-title">
                            <span>ğŸ¯</span>
                            íˆ¬ì ì„±í–¥ ë¶„ì„
                        </h2>

                        <div v-if="riskAnalysis" class="risk-card">
                            <div class="risk-header">
                                <div class="risk-type">{{ getRiskProfileText(riskAnalysis.riskProfile) }}</div>
                                <span :class="['risk-level', getRiskLevelClass(riskAnalysis.riskProfile)]">
                                    {{ riskAnalysis.characteristics?.riskLevel || 'ë³´í†µ' }}
                                </span>
                            </div>

                            <div class="risk-description">
                                {{ riskAnalysis.characteristics?.description }}
                            </div>

                            <div v-if="riskAnalysis.characteristics?.recommendedAssets">
                                <strong>ì¶”ì²œ íˆ¬ì ìƒí’ˆ:</strong>
                                <ul class="recommendation-list">
                                    <li v-for="asset in riskAnalysis.characteristics.recommendedAssets" :key="asset">
                                        {{ asset }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ì²œ -->
                    <div class="section portfolio-section">
                        <h2 class="section-title">
                            <span>ğŸ“Š</span>
                            ì¶”ì²œ í¬íŠ¸í´ë¦¬ì˜¤
                        </h2>

                        <div v-if="portfolioRecommendation">
                            <!-- ìì‚° ë°°ë¶„ -->
                            <div class="allocation-grid">
                                <div v-for="(percentage, asset) in portfolioRecommendation.portfolio" :key="asset" class="allocation-card">
                                    <div class="allocation-title">{{ asset }}</div>
                                    <div class="allocation-percentage">{{ percentage }}%</div>
                                    <div class="allocation-amount">
                                        {{ formatCurrency(calculateAllocationAmount(percentage)) }}
                                    </div>
                                </div>
                            </div>

                            <!-- ì°¨íŠ¸ -->
                            <div class="chart-container">
                                <canvas id="portfolioChart"></canvas>
                            </div>

                            <!-- íˆ¬ì í†µê³„ -->
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value">{{ formatCurrency(portfolioRecommendation.monthlyInvestment) }}</div>
                                    <div class="stat-label">ì›” ê¶Œì¥ íˆ¬ìì•¡</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ riskAnalysis?.characteristics?.expectedReturn || 'N/A' }}</div>
                                    <div class="stat-label">ì˜ˆìƒ ìˆ˜ìµë¥ </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ getRiskLevel() }}</div>
                                    <div class="stat-label">ìœ„í—˜ ìˆ˜ì¤€</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ getInvestmentPeriod() }}</div>
                                    <div class="stat-label">íˆ¬ì ê¸°ê°„</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì´ë“œë°” -->
                <div>
                    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
                    <div class="section">
                        <h2 class="section-title">
                            <span>âš¡</span>
                            ë¹ ë¥¸ ì•¡ì…˜
                        </h2>
                        <div class="quick-actions">
                            <button @click="refreshAnalysis" class="action-btn">
                                ğŸ”„ ë¶„ì„ ìƒˆë¡œê³ ì¹¨
                            </button>
                            <button @click="goToPage('/financial.html')" class="action-btn secondary">
                                âš™ï¸ í”„ë¡œí•„ ìˆ˜ì •
                            </button>
                            <button @click="downloadReport" class="action-btn secondary">
                                ğŸ“„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button @click="goToPage('/dashboard.html')" class="action-btn secondary">
                                ğŸ“ˆ ëŒ€ì‹œë³´ë“œë¡œ
                            </button>
                        </div>
                    </div>

                    <!-- ì‹œì¥ ë™í–¥ -->
                    <div class="section">
                        <h2 class="section-title">
                            <span>ğŸ“ˆ</span>
                            ì‹œì¥ ë™í–¥
                        </h2>
                        <div class="trend-item">
                            <div class="trend-info">
                                <div class="trend-icon">ğŸ“Š</div>
                                <div class="trend-details">
                                    <h4>ì½”ìŠ¤í”¼</h4>
                                    <p>í•œêµ­ ì£¼ì‹ì‹œì¥</p>
                                </div>
                            </div>
                            <div class="trend-change">
                                <div class="change-value change-positive">+2.5%</div>
                                <div class="change-period">ì˜¤ëŠ˜</div>
                            </div>
                        </div>

                        <div class="trend-item">
                            <div class="trend-info">
                                <div class="trend-icon">ğŸ›ï¸</div>
                                <div class="trend-details">
                                    <h4>êµ­ê³ ì±„ 3ë…„</h4>
                                    <p>ì•ˆì „ ìì‚°</p>
                                </div>
                            </div>
                            <div class="trend-change">
                                <div class="change-value change-negative">-0.1%</div>
                                <div class="change-period">ì´ë²ˆ ì£¼</div>
                            </div>
                        </div>

                        <div class="trend-item">
                            <div class="trend-info">
                                <div class="trend-icon">ğŸ’±</div>
                                <div class="trend-details">
                                    <h4>ì›/ë‹¬ëŸ¬</h4>
                                    <p>í™˜ìœ¨</p>
                                </div>
                            </div>
                            <div class="trend-change">
                                <div class="change-value change-positive">+1.2%</div>
                                <div class="change-period">ì´ë²ˆ ë‹¬</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íˆ¬ì íŒ ì„¹ì…˜ -->
            <div v-if="hasProfile" class="tips-section">
                <h2 class="section-title">
                    <span>ğŸ’¡</span>
                    íˆ¬ì íŒ & ì¡°ì–¸
                </h2>

                <div v-if="portfolioRecommendation?.goalBasedRecommendation">
                    <div class="tip-item">
                        <div class="tip-title">
                            <span>ğŸ¯</span>
                            ë§ì¶¤í˜• íˆ¬ì ì „ëµ
                        </div>
                        <div class="tip-content">
                            {{ portfolioRecommendation.goalBasedRecommendation.strategy }}
                        </div>
                    </div>

                    <div v-if="portfolioRecommendation.goalBasedRecommendation.tips" class="tip-item">
                        <div class="tip-title">
                            <span>âœ¨</span>
                            ì‹¤ìš©ì ì¸ íˆ¬ì ì¡°ì–¸
                        </div>
                        <div class="tip-content">
                            <ul>
                                <li v-for="tip in portfolioRecommendation.goalBasedRecommendation.tips" :key="tip">
                                    {{ tip }}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="tip-item">
                    <div class="tip-title">
                        <span>ğŸ“š</span>
                        ê¸°ë³¸ íˆ¬ì ì›ì¹™
                    </div>
                    <div class="tip-content">
                        ë¶„ì‚° íˆ¬ìë¥¼ í†µí•´ ìœ„í—˜ì„ ì¤„ì´ê³ , ì¥ê¸°ì ì¸ ê´€ì ì—ì„œ ê¾¸ì¤€íˆ íˆ¬ìí•˜ì„¸ìš”.
                        ì‹œì¥ì˜ ë‹¨ê¸° ë³€ë™ì— ì¼í¬ì¼ë¹„í•˜ì§€ ë§ê³ , ë³¸ì¸ì˜ íˆ¬ì ëª©í‘œì™€ ì„±í–¥ì— ë§ëŠ” ì „ëµì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="tip-item">
                    <div class="tip-title">
                        <span>âš ï¸</span>
                        ìœ„í—˜ ê´€ë¦¬
                    </div>
                    <div class="tip-content">
                        íˆ¬ì ê¸ˆì•¡ì€ ìƒí™œë¹„ì™€ ë¹„ìƒê¸ˆì„ ì œì™¸í•œ ì—¬ìœ  ìê¸ˆìœ¼ë¡œ í•œì •í•˜ì„¸ìš”.
                        í•œ ë²ˆì— í° ê¸ˆì•¡ì„ íˆ¬ìí•˜ê¸°ë³´ë‹¤ëŠ” ì‹œê°„ì„ ë¶„ì‚°í•˜ì—¬ ì •ê¸°ì ìœ¼ë¡œ íˆ¬ìí•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, reactive, onMounted, computed } = Vue;

    createApp({
        setup() {
            const isLoading = ref(true);
            const user = ref(null);
            const alertMessage = ref('');
            const alertType = ref('info');
            const hasProfile = ref(false);
            const riskAnalysis = ref(null);
            const portfolioRecommendation = ref(null);

            let portfolioChart = null;

            // API ê¸°ë³¸ ì„¤ì •
            const API_BASE_URL = '/api';
            axios.defaults.baseURL = API_BASE_URL;

            // í† í° ì„¤ì •
            const token = localStorage.getItem('accessToken');
            if (token) {
                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            } else {
                window.location.href = '/member.html';
                return;
            }

            // ì•Œë¦¼ í‘œì‹œ
            const showAlert = (message, type = 'info', duration = 5000) => {
                alertMessage.value = message;
                alertType.value = type;
                setTimeout(() => {
                    alertMessage.value = '';
                }, duration);
            };

            // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
            const loadUserInfo = async () => {
                try {
                    const response = await axios.get('/auth/me');
                    if (response.data.success) {
                        user.value = response.data.data;
                    }
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                    localStorage.removeItem('accessToken');
                    window.location.href = '/member.html';
                }
            };

            // ê¸ˆìœµ í”„ë¡œí•„ í™•ì¸
            const checkProfile = async () => {
                try {
                    const response = await axios.get('/financial/profile');
                    if (response.data.success) {
                        hasProfile.value = response.data.data.hasProfile;
                        if (!hasProfile.value) {
                            showAlert('íˆ¬ì ë¶„ì„ì„ ìœ„í•´ ë¨¼ì € ê¸ˆìœµ í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'warning');
                        }
                    }
                } catch (error) {
                    hasProfile.value = false;
                    showAlert('ê¸ˆìœµ í”„ë¡œí•„ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            // íˆ¬ì ì„±í–¥ ë¶„ì„ ë¡œë“œ
            const loadRiskAnalysis = async () => {
                try {
                    const response = await axios.get('/financial/risk-analysis');
                    if (response.data.success) {
                        riskAnalysis.value = response.data.data;
                    }
                } catch (error) {
                    showAlert('íˆ¬ì ì„±í–¥ ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            // í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ì²œ ë¡œë“œ
            const loadPortfolioRecommendation = async () => {
                try {
                    const response = await axios.get('/financial/portfolio-recommendation');
                    if (response.data.success) {
                        portfolioRecommendation.value = response.data.data;
                    }
                } catch (error) {
                    showAlert('í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ì²œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            // í¬íŠ¸í´ë¦¬ì˜¤ ì°¨íŠ¸ ìƒì„±
            const createPortfolioChart = () => {
                const ctx = document.getElementById('portfolioChart');
                if (!ctx || !portfolioRecommendation.value) return;

                const data = {
                    labels: Object.keys(portfolioRecommendation.value.portfolio),
                    datasets: [{
                        data: Object.values(portfolioRecommendation.value.portfolio),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#f5576c',
                            '#4facfe',
                            '#00f2fe'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                };

                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            };

            // í†µí™” í¬ë§·
            const formatCurrency = (amount) => {
                if (amount == null) return 'â‚©0';
                return new Intl.NumberFormat('ko-KR', {
                    style: 'currency',
                    currency: 'KRW',
                    minimumFractionDigits: 0
                }).format(amount);
            };

            // ìœ„í—˜ ì„±í–¥ í…ìŠ¤íŠ¸
            const getRiskProfileText = (riskProfile) => {
                const texts = {
                    CONSERVATIVE: 'ì•ˆì •í˜• íˆ¬ìì',
                    MODERATE: 'ì¤‘ë„í˜• íˆ¬ìì',
                    AGGRESSIVE: 'ê³µê²©í˜• íˆ¬ìì'
                };
                return texts[riskProfile] || riskProfile;
            };

            // ìœ„í—˜ ìˆ˜ì¤€ í´ë˜ìŠ¤
            const getRiskLevelClass = (riskProfile) => {
                const classes = {
                    CONSERVATIVE: 'risk-low',
                    MODERATE: 'risk-medium',
                    AGGRESSIVE: 'risk-high'
                };
                return classes[riskProfile] || 'risk-medium';
            };

            // ìì‚° ë°°ë¶„ ê¸ˆì•¡ ê³„ì‚°
            const calculateAllocationAmount = (percentage) => {
                if (!portfolioRecommendation.value?.monthlyInvestment) return 0;
                return portfolioRecommendation.value.monthlyInvestment * (percentage / 100);
            };

            // ìœ„í—˜ ìˆ˜ì¤€ í…ìŠ¤íŠ¸
            const getRiskLevel = () => {
                return riskAnalysis.value?.characteristics?.riskLevel || 'ë³´í†µ';
            };

            // íˆ¬ì ê¸°ê°„ í…ìŠ¤íŠ¸
            const getInvestmentPeriod = () => {
                return 'ì¥ê¸° (5ë…„+)';
            };

            // ë¶„ì„ ìƒˆë¡œê³ ì¹¨
            const refreshAnalysis = async () => {
                isLoading.value = true;
                showAlert('ë¶„ì„ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');

                try {
                    await Promise.all([
                        loadRiskAnalysis(),
                        loadPortfolioRecommendation()
                    ]);

                    // ì°¨íŠ¸ ì¬ìƒì„±
                    if (portfolioChart) {
                        portfolioChart.destroy();
                    }
                    setTimeout(createPortfolioChart, 100);

                    showAlert('ë¶„ì„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    showAlert('ë¶„ì„ ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                } finally {
                    isLoading.value = false;
                }
            };

            // ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
            const downloadReport = () => {
                showAlert('ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
            };

            // í˜ì´ì§€ ì´ë™
            const goToPage = (url) => {
                window.location.href = url;
            };

            // ì´ˆê¸°í™”
            const initialize = async () => {
                isLoading.value = true;
                try {
                    await loadUserInfo();
                    await checkProfile();

                    if (hasProfile.value) {
                        await Promise.all([
                            loadRiskAnalysis(),
                            loadPortfolioRecommendation()
                        ]);

                        // ì°¨íŠ¸ëŠ” DOMì´ ì—…ë°ì´íŠ¸ëœ í›„ ìƒì„±
                        setTimeout(createPortfolioChart, 100);
                    }
                } finally {
                    isLoading.value = false;
                }
            };

            onMounted(initialize);

            return {
                isLoading,
                user,
                alertMessage,
                alertType,
                hasProfile,
                riskAnalysis,
                portfolioRecommendation,
                showAlert,
                formatCurrency,
                getRiskProfileText,
                getRiskLevelClass,
                calculateAllocationAmount,
                getRiskLevel,
                getInvestmentPeriod,
                refreshAnalysis,
                downloadReport,
                goToPage
            };
        }
    }).mount('#app');
</script>
</script>
</script>
</body>
</html>